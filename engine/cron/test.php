<?php
define('bk', true);
@ini_set('display_errors', false);
require_once(__DIR__ . '/../classes/mysqli.php');
require_once("./../../config.php");

$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 105622;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '0:1') {
                $evt = '{"1X2":{"1":{"kf":"1.34"},"2":{"kf":"3.29"},"3":{"kf":"3.75"}},"WXM":{"1":{"kf":"1.12"},"2":{"kf":"1.09"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"27"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"17":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '1:1') {
                $evt = '{"1X2":{"1":{"kf":"1.89"},"2":{"kf":"2.62"},"3":{"kf":"1.8"}},"WXM":{"1":{"kf":"1.69"},"2":{"kf":"1.27"},"3":{"kf":"1.38"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"21"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"15":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '1:2') {
                $evt = '{"1X2":{"1":{"kf":"1.43"},"2":{"kf":"2.99"},"3":{"kf":"3.21"}},"WXM":{"1":{"kf":"1.35"},"2":{"kf":"1.17"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"13"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"11":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '2:2') {
                $evt = '{"1X2":{"1":{"kf":"1.81"},"2":{"kf":"2.71"},"3":{"kf":"1.21"}},"WXM":{"1":{"kf":"1.41"},"2":{"kf":"1.31"},"3":{"kf":"1.43"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"1"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"1":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}

unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 105639;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '1:0') {
                $evt = '{"1X2":{"1":{"kf":"1.34"},"2":{"kf":"3.29"},"3":{"kf":"3.75"}},"WXM":{"1":{"kf":"1.12"},"2":{"kf":"1.09"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"9"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"27"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"17":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '2:0') {
                $evt = '{"1X2":{"1":{"kf":"1.21"},"2":{"kf":"2.99"},"3":{"kf":"4.21"}},"WXM":{"1":{"kf":"1.03"},"2":{"kf":"1.17"},"3":{"kf":"1.91"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"1"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"13"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"11":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}
unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 105644;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '0:1') {
                $evt = '{"1X2":{"1":{"kf":"3.21"},"2":{"kf":"1.84"},"3":{"kf":"2.79"}},"WXM":{"1":{"kf":"1.82"},"2":{"kf":"1.24"},"3":{"kf":"1.24"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"1"},"16":{"kf":"9.11"},"17":{"kf":"18"},"18":{"kf":"60"},"19":{"kf":"12"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"2.02","lv":"+0.25"},"2":{"kf":"1.68","lv":"-0.25"}}}}';
            } elseif ($score == '1:1') {
                $evt = '{"1X2":{"1":{"kf":"4.11"},"2":{"kf":"1.41"},"3":{"kf":"3.82"}},"WXM":{"1":{"kf":"2.11"},"2":{"kf":"1.07"},"3":{"kf":"1.19"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"1"},"17":{"kf":"9"},"18":{"kf":"60"},"19":{"kf":"5"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.12","lv":"+0.25"},"2":{"kf":"1.48","lv":"-0.25"}}}}';
            } elseif ($score == '1:2') {
                $evt = '{"1X2":{"1":{"kf":"5.71"},"2":{"kf":"1.14"},"3":{"kf":"4.73"}},"WXM":{"1":{"kf":"3.41"},"2":{"kf":"1.11"},"3":{"kf":"1.09"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"100"},"17":{"kf":"1"},"18":{"kf":"60"},"19":{"kf":"1"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.92","lv":"+0.25"},"2":{"kf":"1.28","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}
unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 69375;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT106M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '1:0') {
                $evt = '{"1X2":{"1":{"kf":"1.34"},"2":{"kf":"3.29"},"3":{"kf":"3.75"}},"WXM":{"1":{"kf":"1.12"},"2":{"kf":"1.09"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"9"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"27"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"17":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '2:0') {
                $evt = '{"1X2":{"1":{"kf":"1.21"},"2":{"kf":"2.99"},"3":{"kf":"4.21"}},"WXM":{"1":{"kf":"1.03"},"2":{"kf":"1.17"},"3":{"kf":"1.91"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"1"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"13"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"11":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}
unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 107261;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '0:1') {
                $evt = '{"1X2":{"1":{"kf":"1.34"},"2":{"kf":"3.29"},"3":{"kf":"3.75"}},"WXM":{"1":{"kf":"1.12"},"2":{"kf":"1.09"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"27"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"17":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '1:1') {
                $evt = '{"1X2":{"1":{"kf":"1.89"},"2":{"kf":"2.62"},"3":{"kf":"1.8"}},"WXM":{"1":{"kf":"1.69"},"2":{"kf":"1.27"},"3":{"kf":"1.38"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"21"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"15":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '1:2') {
                $evt = '{"1X2":{"1":{"kf":"1.43"},"2":{"kf":"2.99"},"3":{"kf":"3.21"}},"WXM":{"1":{"kf":"1.35"},"2":{"kf":"1.17"},"3":{"kf":"1.58"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"13"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"11":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            if ($score == '2:2') {
                $evt = '{"1X2":{"1":{"kf":"1.81"},"2":{"kf":"2.71"},"3":{"kf":"1.21"}},"WXM":{"1":{"kf":"1.41"},"2":{"kf":"1.31"},"3":{"kf":"1.43"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"8.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"24"},"7":{"kf":"34"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"140"},"11":{"kf":"6.5"},"12":{"kf":"1"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"7.7"},"16":{"kf":"11.15"},"17":{"kf":"25"},"18":{"kf":"60"},"1":{"kf":"9.8"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"130"}},"INDTOTAL1":{"5":{"1":{"kf":"1.63","lv":"1.5"},"2":{"kf":"2.2","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.93","lv":"1.5"},"2":{"kf":"1.81","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"1.92","lv":"+0.25"},"2":{"kf":"1.88","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}

unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 107262;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '0:1') {
                $evt = '{"1X2":{"1":{"kf":"3.21"},"2":{"kf":"1.84"},"3":{"kf":"2.79"}},"WXM":{"1":{"kf":"1.82"},"2":{"kf":"1.24"},"3":{"kf":"1.24"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"1"},"16":{"kf":"9.11"},"17":{"kf":"18"},"18":{"kf":"60"},"19":{"kf":"12"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"2.02","lv":"+0.25"},"2":{"kf":"1.68","lv":"-0.25"}}}}';
            } elseif ($score == '1:1') {
                $evt = '{"1X2":{"1":{"kf":"4.11"},"2":{"kf":"1.41"},"3":{"kf":"3.82"}},"WXM":{"1":{"kf":"2.11"},"2":{"kf":"1.07"},"3":{"kf":"1.19"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"1"},"17":{"kf":"9"},"18":{"kf":"60"},"19":{"kf":"5"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.12","lv":"+0.25"},"2":{"kf":"1.48","lv":"-0.25"}}}}';
            } elseif ($score == '1:2') {
                $evt = '{"1X2":{"1":{"kf":"5.71"},"2":{"kf":"1.14"},"3":{"kf":"4.73"}},"WXM":{"1":{"kf":"3.41"},"2":{"kf":"1.11"},"3":{"kf":"1.09"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"100"},"17":{"kf":"1"},"18":{"kf":"60"},"19":{"kf":"1"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.92","lv":"+0.25"},"2":{"kf":"1.28","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}
unset($timeout);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



$curr_time = (new \DateTime('now'));//->add(new \DateInterval("PT60M"));

$id = 107263;

$queryEvent = $db->query('SELECT time_start, need_score FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
$result = $queryEvent->fetch_assoc();
$time_start_for_1_match = $result['time_start'];
$needScore = json_decode($result['need_score']);

$time_start = new \DateTime($time_start_for_1_match);
//$time_start->setTime('12', '30');

$time_end = (new DateTime($time_start_for_1_match))->add(new  DateInterval('PT105M'));

if (($curr_time > $time_start) && !($curr_time > $time_end)) {
    $diff = $time_start->diff($curr_time);
    $minutes = $diff->days * 24 * 60;
    $minutes += $diff->h * 60;
    $minutes += $diff->i;
    if (in_array($minutes, [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56])) {
        $timeout = true;
    }

    if ($minutes > 57) {
        $minutes -= 10;
    }


    foreach ($needScore as $min => $score) {
        if ($min == $minutes) {
            $queryEvent = $db->query('SELECT `bets` FROM `events` WHERE `id` = "?s" LIMIT 1', $id);
            $bets = $queryEvent->fetch_assoc()['bets'];
            if ($score == '0:1') {
                $evt = '{"1X2":{"1":{"kf":"3.21"},"2":{"kf":"1.84"},"3":{"kf":"2.79"}},"WXM":{"1":{"kf":"1.82"},"2":{"kf":"1.24"},"3":{"kf":"1.24"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"1"},"16":{"kf":"9.11"},"17":{"kf":"18"},"18":{"kf":"60"},"19":{"kf":"12"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"2.02","lv":"+0.25"},"2":{"kf":"1.68","lv":"-0.25"}}}}';
            } elseif ($score == '1:1') {
                $evt = '{"1X2":{"1":{"kf":"4.11"},"2":{"kf":"1.41"},"3":{"kf":"3.82"}},"WXM":{"1":{"kf":"2.11"},"2":{"kf":"1.07"},"3":{"kf":"1.19"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"1"},"17":{"kf":"9"},"18":{"kf":"60"},"19":{"kf":"5"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.12","lv":"+0.25"},"2":{"kf":"1.48","lv":"-0.25"}}}}';
            } elseif ($score == '1:2') {
                $evt = '{"1X2":{"1":{"kf":"5.71"},"2":{"kf":"1.14"},"3":{"kf":"4.73"}},"WXM":{"1":{"kf":"3.41"},"2":{"kf":"1.11"},"3":{"kf":"1.09"}},"T":{"0":{"1":{"kf":"1.23","lv":"2.0"},"2":{"kf":"3.9","lv":"2.0"}},"1":{"1":{"kf":"1.74","lv":"2.5"},"2":{"kf":"2.1","lv":"2.5"}},"6":{"1":{"kf":"2.37","lv":"2.5"},"2":{"kf":"1.55","lv":"2.5"}}},"1TIMEHAVEGOALS":{"1":{"kf":"1.4"},"2":{"kf":"2.7"}},"2TIMEHAVEGOALS":{"1":{"kf":"1.27"},"2":{"kf":"3.55"}},"OZIN12TYME":{"1":{"kf":"1.87"},"2":{"kf":"1.87"}},"TOTALYNCHET":{"1":{"kf":"1.9"},"2":{"kf":"1.9"}},"SCR0":{"1":{"kf":"4.2"},"2":{"kf":"14"},"3":{"kf":"29"},"4":{"kf":"70"},"5":{"kf":"10.5"},"6":{"kf":"22"},"7":{"kf":"39"},"8":{"kf":"60"},"9":{"kf":"85"},"10":{"kf":"123"},"11":{"kf":"6.5"},"12":{"kf":"15.5"},"13":{"kf":"65"},"14":{"kf":"250"},"15":{"kf":"100"},"16":{"kf":"100"},"17":{"kf":"1"},"18":{"kf":"60"},"19":{"kf":"1"},"20":{"kf":"21"},"21":{"kf":"33"},"22":{"kf":"55"},"23":{"kf":"75"},"24":{"kf":"128"}},"INDTOTAL1":{"5":{"1":{"kf":"1.71","lv":"1.5"},"2":{"kf":"1.80","lv":"1.5"}}},"INDTOTAL2":{"5":{"1":{"kf":"1.89","lv":"1.5"},"2":{"kf":"1.71","lv":"1.5"}}},"F":{"0":{"1":{"kf":"5.5","lv":"-1.5"},"2":{"kf":"3.7","lv":"-1.5"}},"1":{"1":{"kf":"1.25","lv":"+1.5"},"2":{"kf":"1.13","lv":"+1.5"}},"6":{"1":{"kf":"3.92","lv":"+0.25"},"2":{"kf":"1.28","lv":"-0.25"}}}}';
            }
            $db->query('UPDATE `events` SET `is_live` = "?s", `bets` = "?s", `min` = "?s", `curr_time` = "?s", score = "?s" WHERE `events`.`id` = "?s";', 1, $evt, $minutes, $curr_time->format('Y-m-d H:i:s'), $score, $id);
        }
    }
    if ($timeout) {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, 'пер', $curr_time->format('Y-m-d H:i:s'), $id);
    } else {
        $db->query('UPDATE `events` SET `is_live` = "?s", `min` = "?s", `curr_time` = "?s" WHERE `events`.`id` = "?s";', 1, $minutes, $curr_time->format('Y-m-d H:i:s'), $id);
    }
}

if (($curr_time > $time_end) && ($curr_time->diff($time_end)->i < 2)) {
    $db->query('UPDATE `events` SET `is_live` = "?s", `result` = TRUE WHERE `events`.`id` = "?s";', 0, $id);
}

unset($timeout);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////